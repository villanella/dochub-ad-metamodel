imports:
  - config_table.yaml
  - adh_tags_entities.yaml

seaf.change.uc:
  adh.hc_map.edit:
    story: ADH-3677
    title: Edit HC map
    priority: medium
    needatest: true
    description: |

      1. User opens cluster - service
      2. User runs action "Add/Remove components"
      3. User adds, removes or moves one or more components.
      4. User clicks "Run" 
      5. HC map is changed. 
      
      **Alternative Flow**
      
      * 3a1. User hasn't changed HC map.
      * 3a2. Action fails with the error message "No changes applied".

  adh.hc_map.edit2:
    story: ADH-3677
    title: Test UC HC map
    priority: Low
    needatest: false
    description: |
      Blah blah
    

seaf.change.requirements:
  adh.hc_map.edit:
    title: Edit HC map
    type: functional
    story: ADH-3677
    status: Proposed
    priority: Medium
    description: |
      1. Add new action "Add/Remove components" to the service. Remove other changing HC map actions from the service.
      2. Prechecks for Add and Remove **shall** be runned in the beginning of the action:
        - host availability;
        - removing from unavailable host which is not in MM should be available until bug in ADCM has been fixed;    
        - OS compatibility
      3. Disable the components from the ".remove" list
      4. Add components from the ".add" list 
      5. After install/disable only 1 restart of service should be made, and only if it's required. See the relevant component restarts table
      6. Run service post-install/post-expand checks
      7. Raise flags on depended services according to the relevant table for the service.
      8. If HC map is not changed show error message "No components has been selected for HC map changing"
    verifications:
      manual_check:
        title: Remove component from available host
        condition: Component is successfully removed
    usecases:
      - adh.hc_map.edit
    functionality:
      - adh.hc_map

  adh.hc_map.mm:
    title: Edit HC map in MM
    description: Test req
    story: ADH-3676
    usecases:
      - adh.hc_map.edit
      - adh.hc_map.edit2
    type: functional
    status: declined
    verifications:
    functionality:
      - adh.hc_map




seaf.change.adr:
  adh.hc_map.edit:
    title: Edit HC map
    moment: 2024-08-26
    story: ADH-3677
    problem: Too many changing HC map actions
    decision: Combine Add/Remove/Move actions into the single action.
    status: Development
    requirements:
      - adh.hc_map.edit
    old_reqs:
      - adh.hc_map.mm
    deciders:
      - n.krupenkina
      - a.shitov
    usecases:
      - adh.hc_map.edit
    dependencies:
      - test.adr
    issue:
    context:
      -
    consequences:
      -



authors:
  n.krupenkina:
    name: Nadezhda
    surname: Krupenkina
    role: System Analyst
  a.shitov:
    name: Andrey
    surname: Shitov
    role: Architect

aspects:
  adh:
    location: ADH
    title: ADH Aspects

  adh.hc_map:
    title: HC map
    location: ADH/HC map

  adh.security.kerberos:
    title: Kerberos
    location: ADH/Security/Kerberos

components:
  adh:
    title: ADH cluster
    entity: collections
    description: Arenadata Hadoop cluster

  adh.hdfs:
    title: HDFS
    entity: collections
    aspects:
      - adh.hc_map


  adh.hive:
    title: Hive
    entity: collections
    aspects:
      - adh.hc_map


#ttags:
#  tatta:
#    name: tatta
#  tatta2:
#    name: tatta2

contexts:
  adh:
    title: ADH Architecture
    location: ADH
    components:
      - adh.*

  adh.hdfs:
    title: HDFS
    location: ADH/HDFS
    components:
      - adh.hdfs.*

  adh.hive:
    title: HDFS
    location: ADH/Hive
    components:
      - adh.hive.*
  adh.yarn:
    title:
